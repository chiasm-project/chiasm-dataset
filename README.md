# chiasm-dataset
A data structure for representing tabular data.

Intended for use as:

 * the data structure generated by loading data into the browser,
 * the input and output type for data transformations (e.g. filtering and aggregation), and
 * the input type for data visualizations.

This data structure accommodates both relational data tables as well as aggregated multidimensional data.

The purpose of this data structure is to serve as a common data table representation for use in the [Chiasm project](https://github.com/chiasm-project/chiasm). By using this data structure, components for data access, data transformation, and interactive visualization can be interoperable.

# Usage

Note: development has not yet started, following the practice of [README-driven development](http://tom.preston-werner.com/2010/08/23/readme-driven-development.html).

```javascript
var ChiasmDataset = require("chiasm-dataset");
var dataset = new ChiasmDataset(data, metadata);
```

At the time of construction, the data structure is validated according to the constraints detailed below. An exception is thrown if the given `data` and `metadata` values violate any constraints.

When writing functions that accept an object that is supposedly a Dataset, you can use `instanceof` to check if it is in fact a Dataset, like this:

```javascript
if(dataset instanceof Dataset){ ... }
```

# Data Structure Reference

Each `dataset` object has two properties, [`data`](#data) and [`metadata`](#metadata).

<a name="data" href="#data">#</a><i>dataset</i>.<b>data</b>

An array of row objects. This contains all rows of the data table. This is the same data structure returned by [d3-dsv](https://github.com/d3/d3-dsv) after parsing strings into primitive types. Each row object has keys corresponding to column names and values for each cell of the data table. The values are represented in memory as the JavaScript primitive types corresponding the the [declared column type](#type).

<a name="metadata" href="#metadata">#</a><i>dataset</i>.<b>metadata</b>

An object that describes the data table. This includes the properties [isCube](#isCube) and [columns](#columns).

<a name="isCube" href="#isCube">#</a><i>dataset.metadata</i>.<b>isCube</b>

A property set to `true` if this dataset contains aggregated multidimensional data where each row represents a cell of a data cube. This value may be omitted or set to `false` if this dataset contains a relational data table where each row represents an individual entity or event.

When set to `true`, each row contains values for dimensions and measures. In this case, each column is interpreted as either as a dimension or measure, depending on the value of the [isDimension](#isDimension) property.

<a name="columns" href="#columns">#</a><i>dataset.metadata</i>.<b>columns</b>

An array of column descriptor objects. Each of these objects must have the properties [name](#name), [label](#label) and [type](#type). The order of these objects may be used in visualizations (e.g. to define the order of axes in parallel coordinates, or the order of columns in an Excel-like table representation).

If [isCube](#isCube) is `true`, then each of these objects may have the properties [isDimension](#isDimension) and [interval](#interval).

<a name="name" href="#name">#</a><i>dataset.metadata.columns[i]</i>.<b>name</b>

The name of the column. This corresponds to the keys in each row object of [dataset.data](#data).

<a name="label" href="#label">#</a><i>dataset.metadata.columns[i]</i>.<b>label</b>

The label of the column. This is a human-readable string that may be used in user interface elements that represent the column such as column selection widgets or axis labels in visualizations.

<a name="type" href="#type">#</a><i>dataset.metadata.columns[i]</i>.<b>type</b>

The type of the column. This is a string, and must be either "number", "string", or "date".

<a name="isDimension" href="#isDimension">#</a><i>dataset.metadata.columns[i]</i>.<b>isDimension</b>

If this property is set to `true`, then this column represents a data cube dimension. This property is only relevant if [isCube](#isCube) is set to `true`.

If the column represents a dimension and is of type "number" or "date", then it is assumed to represent the result of binned aggregation. In this case, the [interval](#interval) property must be defined.

<a name="interval" href="#interval">#</a><i>dataset.metadata.columns[i]</i>.<b>interval</b>

The interval between bins. This property is only relevant if:

 * the dataset is aggregated ([isCube](#isCube) == `true`) and
 * the column is a dimension ([isDimension](#isDimension) is true), and
 * the column [type](#type) is either "number" or "date".

If the column type is "number", then this property is expected to be a number. This is the width of the numeric bins used, for example, in a histogram or heat map. Only fixed-width numeric binning is supported (variable width binning is not supported at this time).

If the column type is "date", then this property is expected to be a string corresponding to one of the interval types defined in [d3-time](https://github.com/d3/d3-time). This includes, for example, "minute", "hour", "day", "week", "month", and "year".

<a name="domain" href="#domain">#</a><i>dataset.metadata.columns[i]</i>.<b>domain</b>

The domain of this column. This corresponds to the notion of domain in D3 scales.

If the column type is "string", then the domain is an array of unique string values that occur in the column. The ordering of these strings will determine, for example, the postion of bars in a bar chart, or the order in which values are mapped to colors using color scales.

If the column type is "number", then the domain is an array containing two numbers, the minimum (`domain[0]`) and the maximum (`domain[1]`). This is how numeric domains are typically represented in D3 numeric scales.

If the column type is "date", then the domain is an array containing two JavaScript `Date` objects, the minimum (`domain[0]`) and the maximum (`domain[1]`). This is how temporal domains are typically represented in D3 time scales.

# Related Work

This library is essentially a data frame for JavaScript, similar in many ways to:

 * [R Data Frames](http://www.r-tutor.com/r-introduction/data-frame)
 * [Pandas Data Frames](http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html)

I hope I'm not reinventing the wheel here. If you know of any JavaScript data frame library that solves the same problems as this one, please open a GitHub issue.

# Roadmap

The overall goal of this project is to serve as the core data structure exchanged between Chiasm components for representing tabular data. The following components will be modified to use this data structure as input and/or output:

 * [ ] [chiasm-dsv-dataset](https://github.com/chiasm-project/chiasm-dsv-dataset) Output
 * [ ] [chiasm-crossfilter](https://github.com/chiasm-project/chiasm-crossfilter) Input and Output(s)
 * [ ] [chiasm-data-reduction](https://github.com/chiasm-project/chiasm-data-reduction) Input and Output
 * [ ] [chiasm-charts](https://github.com/chiasm-project/chiasm-charts) Input

The constraints that must be validated upon construction include:

 * [ ] Each `dataset` object has two properties, [`data`](#data) and [`metadata`](#metadata).
 * [ ] `data` is an array of row objects.
 * [ ] Each row object has keys corresponding to column names and values represented as the JavaScript primitive types corresponding the the [declared column type](#type).
 * [ ] If <a name="isCube" href="#isCube">#</a><i>dataset.metadata</i>.<b>isCube</b> is true, each column is interpreted as either as a dimension or measure, depending on the value of the [isDimension](#isDimension) property.
 * [ ] <a name="columns" href="#columns">#</a><i>dataset.metadata</i>.<b>columns</b> is an array of column descriptor objects.
 * [ ] Each of these objects must have the properties [name](#name), [label](#label) and [type](#type). 
 * [ ] If [isCube](#isCube) is not `true`, then each of these column descriptor objects must not have the properties [isDimension](#isDimension) or [interval](#interval).
 * [ ] <a name="name" href="#name">#</a><i>dataset.metadata.columns[i]</i>.<b>name</b> corresponds to the keys in each row object of [dataset.data](#data).
 * [ ] <a name="label" href="#label">#</a><i>dataset.metadata.columns[i]</i>.<b>label</b> Should be defined. A validation warning should be raised if the label is missing.
 * [ ] <a name="type" href="#type">#</a><i>dataset.metadata.columns[i]</i>.<b>type</b> must be either "number", "string", or "date".
 * [ ] If <a name="isDimension" href="#isDimension">#</a><i>dataset.metadata.columns[i]</i>.<b>isDimension</b> is set to `true`, then [isCube](#isCube) must be set to `true`.
 * [ ] If <a name="isDimension" href="#isDimension">#</a><i>dataset.metadata.columns[i]</i>.<b>isDimension</b> is set to `true` and the column is of type "number" or "date", then [interval](#interval) must be defined.
 * [ ] If <a name="interval" href="#interval">#</a><i>dataset.metadata.columns[i]</i>.<b>interval</b> is defined, then
   * the dataset is aggregated ([isCube](#isCube) == `true`) and
   * the column is a dimension ([isDimension](#isDimension) is true), and
   * the column [type](#type) is either "number" or "date".
 * [ ] If the column type is "number", then `interval` must be a number. 
 * [ ] If the column type is "date", then `interval` must be a string corresponding to one of the interval types defined in [d3-time](https://github.com/d3/d3-time). This includes, for example, "minute", "hour", "day", "week", "month", and "year".
 * [ ] If <a name="interval" href="#interval">#</a><i>dataset.metadata.columns[i]</i>.<b>interval</b> is defined, then data values should be spaced according to this interval (relative to any other data value from the column) when the column type is "number".
 * [ ] If <a name="interval" href="#interval">#</a><i>dataset.metadata.columns[i]</i>.<b>interval</b> is defined, then data values should be spaced according to this interval (relative to any other data value from the column) when the column type is "date".
 * [ ] If <a name="domain" href="#domain">#</a><i>dataset.metadata.columns[i]</i>.<b>domain</b> is defined and the column type is "string", then the domain must be an array of unique string values that occur in the column.
 * [ ] If <a name="domain" href="#domain">#</a><i>dataset.metadata.columns[i]</i>.<b>domain</b> is defined and the column type is "number", then the domain must be an array containing two numbers, the minimum (`domain[0]`) and the maximum (`domain[1]`).
 * [ ] If <a name="domain" href="#domain">#</a><i>dataset.metadata.columns[i]</i>.<b>domain</b> is defined and the column type is "number", then all values in the column must fall within the domain.
 * [ ] If <a name="domain" href="#domain">#</a><i>dataset.metadata.columns[i]</i>.<b>domain</b> is defined and the column type is "date", then the domain is an array containing two JavaScript `Date` objects, the minimum (`domain[0]`) and the maximum (`domain[1]`).
 * [ ] If <a name="domain" href="#domain">#</a><i>dataset.metadata.columns[i]</i>.<b>domain</b> is defined and the column type is "date", then all values in the column must fall within the domain.


Variable width binning should be supported in the future (e.g. Jenks Natural Breaks for Choropleth maps).
